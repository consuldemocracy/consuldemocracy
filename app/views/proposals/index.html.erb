<% provide :title do %>
  <%= t('proposals.index.title') %>
<% end %>

<% content_for :header_addon do %>
  <%= render "shared/search_form",
             search_path: current_path_with_query_params(page: 1),
             i18n_namespace: "proposals.index.search_form" %>
<% end %>

<main>
  <div class="row">
    <div id="proposals" class="proposals-list small-12 medium-9 column">

      <div class="small-12 search-results">
        <% if @search_terms || @advanced_search_terms %>
          <h2>
            <%= page_entries_info @proposals %>
            <% if !@advanced_search_terms %>
              <%= t("proposals.index.search_results",
                    count: @proposals.size,
                    search_term: @search_terms) %>
            <% end %>
          </h2>
        <% elsif @tag_filter %>
          <h2>
            <%= page_entries_info @proposals %>
            <%= t("proposals.index.filter_topic",
                  count: @proposals.size,
                  topic: @tag_filter) %>
          </h2>
        <% elsif params[:retired].present? %>
          <h2><%= t("proposals.index.retired_proposals") %>
        <% end %>
      </div>

      <% if display_budget_countdown? %>
        <%= render "shared/budget_counter_banner" %>
      <% end %>

      <% if has_banners? %>
        <%= render "shared/banner" %>
      <% end %>

      <% if feature?("probe.plaza") %>
        <%= render "custom/probes/plaza/banner" %>
      <% elsif @proposal_successfull_exists %>
        <%= render "proposal_ballots_banner" %>
      <% elsif @featured_proposals.present? %>
        <div id="featured-proposals" class="row featured-proposals">
          <div class="small-12 column">
            <h2>
              <%= t("proposals.index.featured_proposals") %>
            </h2>
          </div>
          <% @featured_proposals.each do |featured_proposal| %>
            <%= render "featured_proposal", proposal: featured_proposal %>
          <% end %>
        </div>
      <% end %>

      <% unless params[:retired].present? %>
        <%= render "shared/advanced_search",
                   search_path: path_to_search_proposals  %>
      <% end %>
      <%= render 'shared/order_links', i18n_namespace: "proposals.index" %>

      <% if request.path != human_rights_proposals_path %>
        <div class="show-for-small-only">
          <%= link_to t("proposals.index.start_proposal"),
                      new_proposal_path,
                      class: 'button expanded' %>
        </div>
      <% end %>

      <div id="proposals-list">
        <%= render partial: 'proposals/proposal', collection: @proposals %>
        <%= paginate @proposals %>
      </div>
    </div>

    <div class="small-12 medium-3 column">
      <aside class="margin-bottom">
        <% if request.path != human_rights_proposals_path %>
          <%= link_to t("proposals.index.start_proposal"),
                      new_proposal_path,
                      class: 'button expanded' %>
        <% end %>

        <% if params[:retired].blank? %>
          <% if request.path != human_rights_proposals_path %>
            <%= render "shared/tag_cloud", taggable: 'proposal' %>
          <% end %>
            <%= render 'categories' %>
            <%= render 'geozones' %>
            <%= render 'popular' %>
          <% end %>
          <%= render 'retired' %>
      </aside>
    </div>

  </div>
</main>
